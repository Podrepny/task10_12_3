#cloud-config
#password: qwerty
#chpasswd: { expire: False }
ssh_authorized_keys:
  - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQC2k8tHRhIcI3CTes782/QNj5Xx/mrznv01+22e6KHLoeAqJ5YgeaK6nPuixh82P0eIv+iSNBAJX4YFi01CqZqNYBQgmT0W4PRLUdZjnjNeBleEGNGIsluQPNtzm47vpgJHJz37vxpFj2lS2sWvMEtd30e0iImgTJo7kbTkAPemDYRSbKX44qV6KdfFztTZXqvvfwuweDtUysKChRi+x8E+mokzLixA7UZjuQLyKC/2Jze8aI2Ub30qxQZBM7WbreVMyVSHGnw9Y00xB/FGjQW2sdiGXckU0AvA364VDOWPb04uBKUbS/hOCiw14iISJnDfT4Cvpl/XD5dcUg1QxTJrtY2zexeZJ48Bpu/gBOq8o/zNQLIwwz57tWA190dLT6ebfzIozmga/A8yR45cF16WK+aCWk7+9HQkdRSnM5ag9j1LBUjqCu1H8bYtCCW9NmMi8XkHYewLq/sHjTLgkWGcgMnirlcWh0/pDt7T3a6adgg10nyBsi4kNH7kXY6thW29F0ovs0emTXZob2d6MVAzsluHjwDqjF3phHWrD/oA3ghGGwd1X/oa/bHzlYX55IuEGChyeGbcEAAQRrAVik5XBzK0SrSwgkPYeNdSamBwPfgyAi69E0+fevyrM530bOXNr2jtU2lvmruD9Yld56RRgalY9LAZO0fC/uSCSJEv9w== root@ubuntu-server-16

runcmd:
 - [ sh, -c, "/sbin/sysctl net.ipv4.ip_forward=1" ]
 - [ sh, -c, "/sbin/iptables -t nat -A POSTROUTING -s 192.168.124.102 -o ens3 -j MASQUERADE" ]
 - [ sh, -c, "/sbin/ip link add vxlan0 type vxlan id 12345 remote 192.168.124.102 local 192.168.124.101 dstport 4789" ]
 - [ sh, -c, "/sbin/ip link set vxlan0 up" ]
 - [ sh, -c, "/sbin/ip addr add 10.255.0.101/24 dev vxlan0" ]
 - [ sh, -c, "/usr/bin/curl -fsSL https://download.docker.com/linux/ubuntu/gpg | /usr/bin/apt-key add -" ]
 - [ sh, -c, '/usr/bin/add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu xenial stable"' ]
 - [ sh, -c, "/usr/bin/apt-get update" ]
 - [ sh, -c, "/usr/bin/apt-get -y install docker-ce docker-compose bridge-utils" ]
# - [ sh, -c, "/bin/mount -o ro /dev/sr0 /media" ]
# - [ sh, -c, "/bin/mkdir -p /srv/certs /srv/nginx /srv/docker-compose" ]
# - [ sh, -c, "/bin/mkdir -p /srv/log/nginx" ]
# - [ sh, -c, "/bin/cp -fr /media/certs/* /srv/certs" ]
# - [ sh, -c, "/bin/cp -f /media/etc/nginx.conf /srv/nginx/" ]
# - [ sh, -c, "/bin/cp -f /media/docker-compose.yml /srv/docker-compose/" ]
# - [ sh, -c, "/bin/umount /media" ]
# - [ sh, -c, "/bin/echo OOKK" ]
# - [ sh, -c, "cd /srv/docker-compose ; /bin/pwd ; /usr/bin/docker-compose --verbose up -d" ]
# - [ sh, -c, "/usr/bin/docker-compose --verbose up -d" ]
# - [ sh, -c, "/bin/sleep 25" ]
# - [ sh, -c, "CNT=0; while :; do /usr/bin/docker-compose ps | /bin/grep Up > /dev/null ; if [ 0 -eq \"0\" ]; then /bin/echo Yes ; if [ \"\" -ge \"240\" ]; then /bin/echo \"TIMEOUT\" ; break; fi ; else /bin/echo NO ; break ; fi ; /bin/sleep 0.5 ; ((CNT++)) ; /bin/echo \"CNT: \" ; done" ]
# - [ sh, -c, "/bin/sleep 5 ; /usr/bin/docker ps ; /bin/date" ]

#!/bin/bash
mount /dev/cdrom /mnt/
#mkdir -p /root/.ssh
#cat /home/ubuntu/.ssh/authorized_keys > /root/.ssh/authorized_keys
#chmod 600 /root/.ssh/authorized_keys
mkdir -p /srv/rrrrr
